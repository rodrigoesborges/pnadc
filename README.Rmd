---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
library(pnadc)
```

# pnadc

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
<!-- badges: end -->

O objetivo desse pacote é automatizar algumas análises feitas com os 
microdados da PNAD Contínua.

> Ainda em fase MEGA-EXPERIMENTAL.
A API VAI MUDAR

## Instalação

``` r
install.packages("pnadc")
```

## Como usar

O pacote foi pensado para que poassa ser usadao assim:

### Ler dados da PNAD Continua

Há funções de utilidade para baixar os dados da PNAD e para
extrair os arquivos.

```{r download, eval = FALSE}
library(pnadc)
# Vai baixar numa pasta "dados" na raiz do projeto.
# Isso não vai ser possível de alterar pelo pacote para dar uma 
# estrutura de trabalho homogênea e que possa ser confiada
download_pnad(2019, 4)
unzip_pnad(2019, 4)
```

Assim como para leitura dos dados com as variaveis padronizadas.

```{r leitura}
pnad2019_4 <- ler_pnad(2019, 4)
```


### Funções de utilidade

A PNAD é uma pesquisa estratificada e em geral é analisada usando o pacote
`survey`. Mas esse pacote é muito lento para realizar alguns cálculos e 
principalemente para fazer análises exploratórias.

```{r utils}
pnad2019_4 %>% 
  # Na verdade um contador respeitando os pesos
  participacao(sexo)

# Deve funcionar com group_by
# Ainda não funciona
library(dplyr)
pnad2019_4 %>% 
  group_by(vinculo_primario) %>% 
  participacao(sexo)

pnad2019_4 %>% 
  tidyr::nest(data = -vinculo_primario) %>%
  mutate(prop = purrr::map(data, participacao, sexo)) %>% 
  select(-data) %>% 
  tidyr::unnest(prop)

```
```

O ideal era que essas funções de utilidade não se contivessem apenas 
a dados relativos mas também fossem capazes de somar totais.

```{r totais, eval = FALSE}
pnad2019_4 %>% 
  # Na verdade um somador respeitando os pesos e as projeções de pop
  total(sexo)

# Deve funcionar com group_by
pnad2019_4 %>% 
  grou_by(regiao) %>% 
  total(sexo)
```


